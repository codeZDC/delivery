<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tuzhi.delivery.mapper.IDeliveryMapper">
	<resultMap id="userMap" type="com.tuzhi.delivery.domain.vo.UserExtend">
		<id column="id" property="id" />
		<result column="unit_name" property="unitName" />
		<result column="deliveryStatus" property="deliveryStatus" />
		<result column="examineYear" property="examineYear" />
	</resultMap>
	<select id="getDeliveriesByParam" resultType="com.tuzhi.delivery.domain.vo.DeliveriesSearchVo">
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'dlxx' TYPE FROM
		t_delivery_dlxx WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'gccl' TYPE FROM
		t_delivery_gccl WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'gps' TYPE FROM
		t_delivery_gps WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'hsyx' TYPE FROM
		t_delivery_hsyx WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'mndt' TYPE FROM
		t_delivery_mndt WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'ptdt' TYPE FROM
		t_delivery_ptdt WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'szdt' TYPE FROM
		t_delivery_szdt WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'szw' TYPE FROM
		t_delivery_szw WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'wxyx' TYPE FROM
		t_delivery_wxyx WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'yqjy' TYPE FROM
		t_delivery_yqjy WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'zych' TYPE FROM
		t_delivery_zych WHERE status = #{param1} AND year = #{param2}
		UNION ALL
		 SELECT count(id) counts,IFNULL(sum(chfwzz),0) valuesSum, 'zytz' TYPE FROM
		t_delivery_zytz WHERE status = #{param1} AND year = #{param2}
	</select>
	<select id="getDeliveries" resultType="com.tuzhi.delivery.domain.Delivery">
		SELECT id , xtmc xmmc , `status` , iscopy , remarks , 'dlxx' TYPE FROM
		t_delivery_dlxx WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , xmmc xmmc , `status` , iscopy , remarks , 'gccl' TYPE FROM
		t_delivery_gccl WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , xmmc xmmc , `status` , iscopy , remarks , 'gps' TYPE FROM
		t_delivery_gps WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , xmmc xmmc , `status` , iscopy , remarks , 'hsyx' TYPE FROM
		t_delivery_hsyx WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , xmmc xmmc , `status` , iscopy , remarks , 'mndt' TYPE FROM
		t_delivery_mndt WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , tm xmmc , `status` , iscopy , remarks , 'ptdt' TYPE FROM
		t_delivery_ptdt WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , xmmc xmmc , `status` , iscopy , remarks , 'szdt' TYPE FROM
		t_delivery_szdt WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , xmmc xmmc , `status` , iscopy , remarks , 'szw' TYPE FROM
		t_delivery_szw WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , xmmc xmmc , `status` , iscopy , remarks , 'wxyx' TYPE FROM
		t_delivery_wxyx WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , jycmc xmmc , `status` , iscopy , remarks , 'yqjy' TYPE FROM
		t_delivery_yqjy WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , xmmc xmmc , `status` , iscopy , remarks , 'zych' TYPE FROM
		t_delivery_zych WHERE user_id = #{param1} AND year = #{param2}
		UNION ALL
		SELECT id , tm xmmc , `status` , iscopy , remarks , 'zytz' TYPE FROM
		t_delivery_zytz WHERE user_id = #{param1} AND year = #{param2}
	</select>

	<sql id="column_Where">
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="id != null">and id=#{id}</if>
		</trim>
	</sql>

	<update id="toExamine">
		update ${param1} set status = #{param2} where id = #{param3}
	</update>

	<select id="getCompanies" resultMap="userMap">
		SELECT u.id id,u.unit_name unit_name,ds.status deliveryStatus
		,IFNULL(ds.year,#{examineYear}) examineYear FROM t_user u
		LEFT JOIN t_delivery_status ds
		ON ds.`user_id`=u.`id` AND ds.`year` = #{examineYear}
		<where>
			<if test=" examineType == 0">
				and left(u.`delivery_zone`,4) = #{deliveryCode}
			</if>
			<if test="examineType != 0">
				and u.`delivery_zone` = #{deliveryCode}
			</if>
			<if test="deliveryStatus != null and deliveryStatus != '' ">
				AND ds.status = #{deliveryStatus}
			</if>
			<if test="companyName != null and companyName != '' ">
				AND u.unit_name like '%${companyName}%'
			</if>
			<if test="1 == 1">
				AND u.user_type = 0
			</if>
		</where>
	</select>
	
	<!-- 统计获取汇交数量和汇交总值 -->
	<select id="getTotalMsg" resultType="map">
		SELECT t.`admin_zone` zoneCode,COUNT(t.id) count,SUM(t.`chfwzz`) valueSum FROM ${param1} t 
		WHERE  t.`status`=8 AND t.`year`= #{param2}
		GROUP BY t.`admin_zone`
	</select>
</mapper>
