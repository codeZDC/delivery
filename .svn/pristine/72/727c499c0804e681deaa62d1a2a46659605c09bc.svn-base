jQuery(function($){
	$('#myTab').on('click','.dropdown-info>li',function(){
		$(this).attr('zoneCode');
		//改变title
		$('#cityName').text($(this).text());
	});
});

//设置当前时间
//当文档加载完成,获取省市县信息,,
$(function(){
	getPcd();//获取用户下的省市县
});

function getPcd(){
	$.getJSON(contextPath+'zone/getPcd',function(res){
		var data = res.data;
		console.log(data);
		if(!data){
			alert('网络错误,请联系管理员');return;
		}
		if(data[0].zoneCode.length==6){//县级审批员
			buildDistrct(data);
		}else{//省级市级审批
			buildCitys(data);
		}
	});
}
function buildDistrct(data){
	var li = $('<li>').addClass('dropdown active'); 
	var a  =  $('<a aria-expanded="false"> '+ data[0].zoneName+' </a>');
	li.append(a).appendTo($('#myTab').empty());
}
function buildCitys(data){
	var a , 
	ul,
	li = $('<li>').addClass('dropdown'), 
	myTab = $('#myTab').empty();
	$.each(data,function(index,per){
		a =  $('<a data-toggle="dropdown" class="dropdown-toggle" href="#" aria-expanded="false"> '+
			 per.zoneName+' &nbsp; <i class="ace-icon fa fa-caret-down bigger-110 width-auto"></i></a>');
		ul = $('<ul>').addClass('dropdown-menu dropdown-info');
		$.each(per.citys,function(ind,pe){
			$('<li>').attr('zoneCode',pe.zoneCode).append($('<a>').text(pe.zoneName)).appendTo(ul);
		});
		li.clone().addClass(index==0?'active':'').append(a).append(ul).appendTo(myTab);
	});
}
