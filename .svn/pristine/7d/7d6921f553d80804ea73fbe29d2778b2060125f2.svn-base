package com.tuzhi.delivery.controller;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.github.pagehelper.PageInfo;
import com.tuzhi.delivery.base.BaseController;
import com.tuzhi.delivery.domain.Delivery;
import com.tuzhi.delivery.domain.User;
import com.tuzhi.delivery.service.IDeliveryService;
import com.tuzhi.delivery.util.BootstrapTable;
import com.tuzhi.delivery.util.Tz;

/**
 * 汇交相关处理
 * @author codeZ
 * @date 2018年3月28日 下午3:35:09
 * 
 */
@RestController
@RequestMapping("delivery")
public class DeliveryController extends BaseController {

	@Autowired
	private IDeliveryService deliveryService;
	
	@RequestMapping("getDeliveries")
	public Tz getDeliveries(){
		//通过userID获取汇交项目,//status : 200+相关状态
		Map<String , Object> map =  deliveryService.getDeliveries(getUserId());
		return Tz.success(map.get("status").toString()).map(map);
	}
	
	///提交审核
	@RequestMapping("toExamine")
	public Tz toExamine(@RequestParam(value="ids[]")List<Integer> ids,
						@RequestParam(value="types[]")List<String> types,String remarks){
		try {
			deliveryService.toExamine(ids,types,remarks,getUserId());
			return Tz.success("提交成功!");
		} catch (Exception e) {
			logger.error("提交审批出错!");
			logger.error(e.getMessage());
			return Tz.fail("提交失败!");
		}
	}
	
	//code汇交编码,type = 0 表示初始化,,需要模糊查询或left(..,4)
	@RequestMapping("getCompanies")
	public BootstrapTable getCompanies(Delivery delivery){
		PageInfo<User> page =  deliveryService.getCompanies(delivery);
		return bootstrapTable(page);
	}
	
	
	
	
	
}
